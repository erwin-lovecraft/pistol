<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <title>Pistol — Minimalist Webhook Receiver </title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="Pistol: lightweight room message viewer & push. SSE real-time observability with zero fluff." />
    <meta name="theme-color" content="#f5f5f7" />

    <!-- Open Graph / social preview -->
    <meta property="og:title" content="Pistol — Minimalist Room Message Viewer" />
    <meta property="og:description" content="Watch room messages in real-time via SSE and push new messages. Zero UI friction." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{.BaseURL}}" />
    <meta property="og:image" content="{{.BaseURL}}static/og-preview.png" />

    <!-- Twitter card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Pistol — Minimalist Room Message Viewer" />
    <meta name="twitter:description" content="Watch room messages in real-time via SSE and push new messages. Zero UI friction." />
    <meta name="twitter:image" content="{{.BaseURL}}static/og-preview.png" />

    <link rel="icon" href="/static/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Pistol" />
    <meta name="application-name" content="Pistol" />
    <link rel="manifest" href="/static/site.webmanifest" />
    <style>
        :root {
            --bg: #F6EEDB;
            --card: #FAF3E6;
            --radius: 20px;
            --shadow: 0 4px 16px rgba(193,167,120,0.11);
            --border: 1.5px solid #CBB489;
            --text: #6A5737;
            --muted: #A9986B;
            --accent: #B6BF6A;     /* Button/Primary pastel green */
            --accent-hover: #C6DBA6;
            --note-bg: rgba(240, 222, 182, 0.6);
            --inline: #EFE8D8;
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-family: var(--font-family);
        }
        header {
            padding: 48px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 {
            margin: 0;
            font-size: 2.1rem;
            font-weight: 700;
            color: #816C41;
            letter-spacing: 1px;
        }
        .sub {
            margin-top: 4px;
            font-size: 1.05rem;
            color: var(--muted);
            font-style: italic;
        }
        main {
            flex: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 0 24px;
        }
        .card {
            background: var(--card);
            border-radius: var(--radius);
            border: var(--border);
            box-shadow: var(--shadow);
            padding: 32px;
            margin: 24px 0;
        }
        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        h2 {
            font-size: 1.4rem;
            color: #927542;
            margin: 0;
            font-weight: 600;
        }
        ul, p {
            color: var(--text);
            font-size: 1.07rem;
            margin-bottom: 1rem;
        }
        pre {
            background: var(--inline);
            border-radius: 10px;
            border: 1px solid #E5D8B5;
            overflow: auto;
            padding: 16px;
            font-family: SFMono-Regular, Menlo, monospace;
            font-size: 0.98rem;
            color: #544C37;
            box-shadow: 0 2px 6px rgba(193,167,120,0.07);
        }
        code {
            font-family: SFMono-Regular, Menlo, monospace;
            background: #EFE8D8;
            padding: 2px 6px;
            border-radius: 6px;
            color: #78643A;
            font-size: 0.97em;
        }
        .inline-code {
            background: #F2E6C4;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.99em;
            color: #7D693E;
            border: 1px solid #E5D8B5;
        }
        .btn {
            display: inline-block;
            padding: 12px 22px;
            border-radius: 14px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            background: var(--accent);
            color: #4B4227;
            border: none;
            box-shadow: 0 2px 4px rgba(193,167,120,0.06);
            transition: background 0.18s;
            font-size: 1rem;
        }
        .btn:hover, .primary:hover {
            background: var(--accent-hover);
        }
        .primary {
            background: var(--accent);
            color: #4B4227;
        }
        .note {
            background: var(--note-bg);
            border: 1px solid #E5D8B5;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.97rem;
            color: #7D693E;
            margin-bottom: 12px;
        }
        footer {
            padding: 24px;
            text-align: center;
            font-size: 0.83rem;
            color: var(--muted);
            letter-spacing: 0.2px;
        }
        @media (max-width: 600px) {
            main { padding: 0 6px; }
            .card { padding: 18px; }
            header { padding: 22px 8px; }
        }
    </style>
</head>
<body>
<header>
    <div>
        <h1>Pistol</h1>
        <div class="sub">Lightweight room messaging viewer & push. No fluff. Minimalist.</div>
    </div>
    <div><small>Quickstart • SSE • Push</small></div>
</header>
<main>
    <div class="card">
        <div class="section-title"><h2 style="margin:0;font-size:1.5rem;">1. Overview</h2></div>
        <p>Watch real-time room messages via Server-Sent Events and push new messages into a room. Designed for developers who want zero friction observability / interaction.</p>
        <ul>
            <li><strong>View messages:</strong> <code class="inline-code">GET /rooms/{id}/views</code> (SSE)</li>
            <li><strong>Push message:</strong> <code class="inline-code">POST /api/v1/rooms/{id}/push</code></li>
        </ul>
    </div>

    <div class="card">
        <div class="section-title"><h2 style="margin:0;font-size:1.5rem;">2. Watch a room (SSE)</h2></div>
        <p>Open a live stream of messages for a given room. Example JavaScript client:</p>
        <pre><code>// replace ROOM_ID with actual ID
const roomID = encodeURIComponent('ROOM_ID');
const evt = new EventSource(`/api/v1/rooms/${roomID}/listen`);

evt.onmessage = e =&gt; {
  try {
    const msg = JSON.parse(e.data);
    console.log('incoming message', msg);
    // render however you want
  } catch (err) {
    console.warn('malformed', e.data);
  }
};

evt.onerror = err =&gt; {
  console.error('SSE error', err);
};
</code></pre>
        <p>Quick curl test (will keep connection open):</p>
        <pre><code>curl -N https://pistol.onrender.com//api/v1/rooms/ROOM_ID/listen</code></pre>
        <div class="note">Use <code class="inline-code">-N</code> to disable buffering so you see each event as it arrives.</div>
    </div>

    <div class="card">
        <div class="section-title"><h2 style="margin:0;font-size:1.5rem;">3. Push a message into a room</h2></div>
        <p>Send a JSON payload to the room. Example:</p>
        <pre><code>POST /api/rooms/ROOM_ID/push
Content-Type: application/json

{
  "method": "PATCH",
  "header": {"x-trace-id": "abc123"},
  "query_params": {"q": "test"},
  "body": {"foo": "bar"}
}</code></pre>
        <p>curl example:</p>
        <pre><code>curl -X POST https://your.host/api/rooms/ROOM_ID/push \
  -H 'Content-Type: application/json' \
  -d '{"method":"POST","header":{"from":"cli"},"query_params":{},"body":{"hello":"world"}}'</code></pre>
    </div>

</main>
<footer>
    Pistol • Minimal observer & push tool — built for developers. Keep it light.
</footer>
</body>
</html>
